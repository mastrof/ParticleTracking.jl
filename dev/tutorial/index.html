<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · ParticleTracking.jl</title><meta name="title" content="Tutorial · ParticleTracking.jl"/><meta property="og:title" content="Tutorial · ParticleTracking.jl"/><meta property="twitter:title" content="Tutorial · ParticleTracking.jl"/><meta name="description" content="Documentation for ParticleTracking.jl."/><meta property="og:description" content="Documentation for ParticleTracking.jl."/><meta property="twitter:description" content="Documentation for ParticleTracking.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ParticleTracking.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Tutorial</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/mastrof/ParticleTracking.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/mastrof/ParticleTracking.jl/blob/main/docs/src/tutorial.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><p>We will use a sample video to test detection and tracking. The video is available here: [xxx]; we will load it with the Download.jl package. We will walk through the entire pipeline, showcasing most of the package features and how to use them to get the best tracking results.</p><p>It is already preprocessed. For convenience, we want to convert the pixel values to Float16 or Float32 values, and normalize these values in the range [0,1].</p><pre><code class="language-julia hljs">using Downloads, TiffImages, CairoMakie
fpath = joinpath(pwd(), &quot;sample_video.tif&quot;)
Downloads.download(
    &quot;https://github.com/mastrof/ParticleTracking.jl/raw/main/docs/src/sample_video.tif&quot;,
    fpath
)
video = TiffImages.load(fpath) .|&gt; Float16
rm(fpath) ## clean up after loading the video
video .-= minimum(video)
video ./= maximum(video)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">512×511×180 Array{Float16, 3}:
[:, :, 1] =
 0.0       0.0       0.012146  0.01619   …  0.004047  0.0       0.0
 0.0       0.0       0.01619   0.0          0.02834   0.0       0.0
 0.0       0.0       0.004047  0.0          0.012146  0.0       0.02429
 0.0       0.0       0.0       0.0          0.0       0.0       0.0
 0.03238   0.0       0.0       0.02023      0.0       0.0       0.0
 0.012146  0.0       0.008095  0.0       …  0.0       0.0       0.004047
 0.02834   0.02023   0.0       0.0          0.0       0.0       0.0
 0.0       0.008095  0.01619   0.008095     0.0       0.0       0.0
 0.0       0.0       0.01619   0.02429      0.0       0.0       0.004047
 0.0       0.008095  0.01619   0.0          0.0       0.012146  0.0
 ⋮                                       ⋱                      ⋮
 0.02834   0.02834   0.02023   0.02023      0.012146  0.02429   0.0
 0.0       0.0       0.05667   0.0          0.0       0.0       0.008095
 0.004047  0.0       0.0       0.008095  …  0.01619   0.0       0.0
 0.0       0.0       0.0       0.0          0.0       0.0       0.0
 0.0       0.004047  0.008095  0.0          0.0       0.04456   0.04047
 0.0       0.0       0.0       0.0          0.0       0.008095  0.012146
 0.02834   0.02429   0.01619   0.012146     0.0       0.0       0.02834
 0.04047   0.012146  0.0       0.02023   …  0.0       0.0       0.0
 0.0       0.0       0.0       0.0          0.01619   0.0       0.0

[:, :, 2] =
 0.0       0.0       0.0       0.012146  …  0.004047  0.0       0.0
 0.04456   0.02429   0.02834   0.004047     0.0       0.008095  0.0
 0.01619   0.008095  0.01619   0.0          0.02023   0.02023   0.004047
 0.0       0.004047  0.0       0.0          0.0       0.0       0.0
 0.0       0.0       0.0       0.0          0.01619   0.02429   0.0
 0.0       0.02023   0.012146  0.0       …  0.0       0.0       0.008095
 0.04047   0.02023   0.004047  0.02429      0.004047  0.0       0.0
 0.0       0.0       0.0       0.0          0.0       0.0       0.0
 0.0       0.0       0.0       0.0          0.012146  0.004047  0.0
 0.0       0.0       0.0       0.0          0.012146  0.01619   0.0
 ⋮                                       ⋱                      ⋮
 0.0       0.0       0.0       0.0          0.01619   0.0       0.01619
 0.02834   0.0       0.004047  0.008095     0.004047  0.0       0.0
 0.0       0.0       0.0       0.0       …  0.02023   0.0       0.0
 0.0       0.0       0.0       0.01619      0.03238   0.01619   0.012146
 0.0       0.0       0.0       0.02429      0.004047  0.0       0.03644
 0.03644   0.01619   0.0       0.0          0.02429   0.01619   0.0
 0.02429   0.012146  0.02023   0.0          0.0       0.004047  0.0
 0.01619   0.004047  0.004047  0.02834   …  0.0       0.004047  0.0
 0.012146  0.012146  0.0       0.0          0.0       0.01619   0.012146

[:, :, 3] =
 0.0       0.0       0.0       0.02023   …  0.0       0.0       0.0
 0.0       0.02429   0.004047  0.004047     0.012146  0.0       0.0
 0.02023   0.0       0.008095  0.0          0.02023   0.004047  0.008095
 0.02023   0.0       0.02429   0.0          0.0       0.008095  0.0
 0.0       0.02023   0.02023   0.0          0.0       0.0       0.008095
 0.0       0.0       0.004047  0.0       …  0.0       0.0       0.004047
 0.01619   0.004047  0.012146  0.012146     0.0       0.01619   0.0
 0.0       0.0       0.03238   0.03644      0.02834   0.04047   0.0
 0.0       0.03238   0.02429   0.004047     0.008095  0.03644   0.0
 0.0       0.02429   0.008095  0.012146     0.0       0.04456   0.008095
 ⋮                                       ⋱                      ⋮
 0.0       0.0       0.0       0.02023      0.03238   0.02023   0.012146
 0.02834   0.012146  0.01619   0.0          0.0       0.008095  0.0
 0.012146  0.0       0.0       0.0       …  0.0       0.02834   0.004047
 0.0       0.0       0.0       0.004047     0.0       0.0       0.0
 0.0       0.012146  0.0       0.004047     0.0       0.008095  0.02834
 0.02023   0.01619   0.0       0.008095     0.0       0.0       0.0
 0.0       0.004047  0.01619   0.012146     0.0       0.01619   0.0
 0.0       0.0       0.01619   0.02023   …  0.02834   0.012146  0.0
 0.004047  0.0       0.012146  0.0          0.02429   0.0       0.0

;;; … 

[:, :, 178] =
 0.0       0.0       0.0       0.02429   …  0.0       0.0       0.0
 0.04456   0.012146  0.02023   0.0          0.008095  0.0       0.0
 0.008095  0.02834   0.004047  0.0          0.02023   0.0       0.008095
 0.0       0.0       0.01619   0.012146     0.012146  0.008095  0.012146
 0.01619   0.0       0.03238   0.04047      0.012146  0.004047  0.0
 0.004047  0.0       0.03644   0.004047  …  0.008095  0.0       0.0
 0.0       0.0       0.0       0.0          0.004047  0.0       0.0
 0.0       0.02023   0.004047  0.0          0.012146  0.02429   0.0
 0.0       0.0       0.02023   0.02429      0.0       0.0       0.0
 0.0       0.0       0.0       0.0          0.004047  0.02023   0.0
 ⋮                                       ⋱                      ⋮
 0.0       0.0       0.012146  0.0          0.0       0.008095  0.0
 0.0       0.0       0.012146  0.0          0.008095  0.0       0.0
 0.0       0.012146  0.0       0.008095  …  0.0       0.0       0.012146
 0.0       0.0       0.0       0.004047     0.008095  0.0       0.0
 0.0       0.0       0.008095  0.02023      0.004047  0.004047  0.004047
 0.0       0.02834   0.008095  0.02023      0.004047  0.0       0.0
 0.03238   0.04456   0.01619   0.01619      0.02023   0.0       0.02023
 0.01619   0.012146  0.004047  0.0       …  0.02429   0.01619   0.0
 0.02834   0.004047  0.0       0.0          0.0       0.0       0.0

[:, :, 179] =
 0.0       0.0       0.02834   0.0       …  0.0       0.0       0.0
 0.012146  0.0       0.0       0.0          0.03644   0.0       0.0
 0.0       0.004047  0.004047  0.0          0.0769    0.03644   0.0
 0.0       0.0       0.01619   0.012146     0.02023   0.008095  0.0
 0.0       0.004047  0.0       0.0          0.012146  0.03238   0.004047
 0.02023   0.02429   0.008095  0.0       …  0.02429   0.0       0.0
 0.02023   0.03644   0.01619   0.0          0.0       0.0       0.0
 0.0       0.02429   0.004047  0.008095     0.0       0.0       0.0
 0.0       0.0       0.004047  0.0          0.012146  0.0       0.0
 0.008095  0.0       0.02834   0.004047     0.02429   0.004047  0.008095
 ⋮                                       ⋱                      ⋮
 0.0       0.0       0.0       0.004047     0.004047  0.012146  0.0
 0.012146  0.01619   0.008095  0.0          0.02834   0.0       0.0
 0.0       0.0       0.0       0.008095  …  0.0       0.0       0.0
 0.0       0.0       0.012146  0.012146     0.004047  0.008095  0.004047
 0.02023   0.0       0.04047   0.02429      0.008095  0.0       0.0
 0.03644   0.0       0.0       0.0          0.008095  0.008095  0.0
 0.02834   0.0       0.0       0.004047     0.01619   0.0       0.004047
 0.0       0.012146  0.01619   0.04047   …  0.004047  0.012146  0.0
 0.02429   0.0       0.0       0.0          0.0       0.012146  0.0

[:, :, 180] =
 0.01619   0.0       0.004047  0.0       …  0.0       0.008095  0.008095
 0.004047  0.02834   0.04047   0.004047     0.02429   0.01619   0.008095
 0.0       0.004047  0.04047   0.004047     0.008095  0.012146  0.02023
 0.0       0.0       0.03644   0.02023      0.0       0.008095  0.0
 0.0       0.0       0.004047  0.0          0.02834   0.03644   0.0
 0.0       0.012146  0.03238   0.0       …  0.01619   0.0       0.0
 0.03644   0.02429   0.05667   0.0          0.004047  0.0       0.0
 0.0       0.012146  0.03238   0.0          0.0       0.004047  0.012146
 0.004047  0.004047  0.04047   0.0          0.0       0.0       0.012146
 0.0       0.0       0.0       0.0          0.02023   0.004047  0.008095
 ⋮                                       ⋱                      ⋮
 0.0       0.0       0.012146  0.0          0.0       0.02834   0.02023
 0.012146  0.0       0.0       0.0          0.004047  0.012146  0.0
 0.004047  0.0       0.0       0.008095  …  0.0       0.0       0.0
 0.0       0.0       0.008095  0.0          0.0       0.0       0.0
 0.012146  0.012146  0.01619   0.0          0.0       0.0       0.0
 0.0       0.0       0.0       0.0          0.0       0.004047  0.04047
 0.02023   0.0       0.008095  0.0          0.004047  0.0       0.01619
 0.008095  0.0       0.01619   0.0       …  0.0       0.0       0.0
 0.008095  0.0       0.0       0.0          0.0       0.01619   0.0</code></pre><p>Before performing the full detection, you can explore the data to find the optimal parameters.</p><p>By loading GLMakie, the <code>explore_blobs</code> function is made available. When calling <code>explore_blobs(video)</code> you will see an interactive window where you can move between the different frames of the video and tune the parameters used for the blob detection: the blob size (i.e. the scale used in the LoG filtering) and the amplitude threshold. You can also zoom in and move the image around.</p><p>On the side, you will also see two scatter plots, showing the amplitude of each detected blob, and their zeroth (<code>m₀</code>) and second (<code>m₂</code>) intensity moments.</p><p>After exploring, we can set the desired parameters and actually perform the detection. We will limit the blob sizes between 2 to 4 pixels, and set the intensity threshold to 0.05.</p><p>The detection is performed with the <code>detect_blobs</code> function, which has to be applied individually to each frame of <code>video</code>.</p><pre><code class="language-julia hljs">using ParticleTracking

blobsize = 2:4
rthresh = 0.05
blobs = [detect_blobs(img, blobsize; rthresh) for img in eachslice(video; dims=3)]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">180-element Vector{Vector{Blob{Float16, 2}}}:
 [Blob(location=(428.766607830552, 56.03076861360719)), Blob(location=(210.04842050750906, 57.05502330398757)), Blob(location=(65.01088099243061, 57.95531959629941)), Blob(location=(6.894755747126437, 125.94049329501915)), Blob(location=(19.995773809523808, 155.9697619047619)), Blob(location=(96.11384222661397, 232.18523550724638)), Blob(location=(138.81044613144758, 238.93926788685525)), Blob(location=(33.12738853503185, 274.81349522292993)), Blob(location=(138.06456289027653, 347.0811217662801)), Blob(location=(283.0436329953198, 394.2092433697348)), Blob(location=(364.99994297445255, 435.7882641423358)), Blob(location=(396.81577966607034, 502.8400417412045)), Blob(location=(472.84660362578336, 504.01113473589976))]
 [Blob(location=(204.8677268244576, 52.00887573964497)), Blob(location=(448.16567750182617, 51.846101168736304)), Blob(location=(65.00928368506493, 58.005225243506494)), Blob(location=(6.9272656691134955, 125.91138481084133)), Blob(location=(20.16062641937926, 156.08549394398185)), Blob(location=(95.98434368737475, 232.9312374749499)), Blob(location=(138.7730198019802, 238.990099009901)), Blob(location=(32.89855551359516, 275.0929003021148)), Blob(location=(138.06549238302503, 346.835997007617)), Blob(location=(283.92921348314604, 394.14648876404493)), Blob(location=(509.02488902980343, 428.9189917564997)), Blob(location=(364.1687722194007, 435.87817420010157)), Blob(location=(388.84678819444446, 498.09804459064327)), Blob(location=(472.95328102710414, 503.9564461483595))]
 [Blob(location=(439.851200613079, 38.90271628065395)), Blob(location=(201.09789364640883, 46.98332182320442)), Blob(location=(65.00955240174673, 58.00644104803494)), Blob(location=(6.910709189497717, 125.93097174657534)), Blob(location=(20.05263489662128, 156.08856530509328)), Blob(location=(95.97956885456885, 232.99404761904762)), Blob(location=(138.78475407747197, 239.03446738022427)), Blob(location=(32.95339652448657, 275.09291074249603)), Blob(location=(137.82603222557904, 346.9601586102719)), Blob(location=(284.01285359327215, 394.179376911315)), Blob(location=(364.98380388940956, 435.8025714620431)), Blob(location=(391.1097317351598, 494.1275684931507)), Blob(location=(472.1726344621514, 503.78264442231074))]
 [Blob(location=(425.13838064295487, 9.791766415868674)), Blob(location=(202.98580063868613, 48.19180542883212)), Blob(location=(65.00569607023411, 58.00783862876254)), Blob(location=(6.894322947872978, 125.91832684242061)), Blob(location=(20.098958333333332, 156.138125)), Blob(location=(95.9425338273196, 233.11295908505156)), Blob(location=(138.95120087336244, 239.15065502183407)), Blob(location=(32.85139202407825, 275.11535929270127)), Blob(location=(138.05087209302326, 346.93545434969855)), Blob(location=(284.03918123100306, 394.119063449848)), Blob(location=(365.0151676109537, 436.00082625118034)), Blob(location=(395.10174313583815, 498.8030166184971)), Blob(location=(472.1985147165698, 504.01557957848837))]
 [Blob(location=(204.2187221975089, 35.900022241992886)), Blob(location=(65.00949111470113, 58.000858239095315)), Blob(location=(6.909787047841307, 125.8579711201867)), Blob(location=(20.19348354525056, 156.05805908750935)), Blob(location=(95.98097474093264, 233.83962111398964)), Blob(location=(138.95080909943715, 239.21857410881802)), Blob(location=(32.868256843800324, 275.21671195652175)), Blob(location=(138.06083548109964, 346.79655283505156)), Blob(location=(284.0143497330282, 394.191790617849)), Blob(location=(365.0802026411658, 435.9773451730419)), Blob(location=(387.8633304195804, 496.8076923076923)), Blob(location=(471.96861131656806, 503.93944156804736))]
 [Blob(location=(201.92259893822393, 48.10388513513514)), Blob(location=(65.02495891536566, 57.97308956450288)), Blob(location=(6.8887878346915015, 125.95372526193248)), Blob(location=(20.117160060210736, 156.14168339187154)), Blob(location=(95.89657928388746, 233.77965153452686)), Blob(location=(139.13608099489795, 239.16738414115648)), Blob(location=(32.87228260869565, 275.82930253623186)), Blob(location=(138.06793006081668, 346.8312337098175)), Blob(location=(283.9886690647482, 394.1406025179856)), Blob(location=(365.8808302238806, 435.9539179104478)), Blob(location=(393.223375, 501.836775)), Blob(location=(471.9525975243811, 503.9685858964741))]
 [Blob(location=(204.9981321157495, 51.78643856736243)), Blob(location=(64.96646090534979, 58.020833333333336)), Blob(location=(6.867010746606335, 125.91211821266968)), Blob(location=(20.80390563435776, 156.1714194247439)), Blob(location=(95.94552529182879, 233.17408398184176)), Blob(location=(139.1018026004728, 239.84278959810874)), Blob(location=(32.920830055074745, 275.1236231313926)), Blob(location=(137.9894225983076, 345.9374066699851)), Blob(location=(283.9913809707242, 394.1924595531587)), Blob(location=(365.84689425051334, 436.2275410677618)), Blob(location=(393.17083333333335, 492.89162234042556)), Blob(location=(471.8121511818779, 503.15056631648065))]
 [Blob(location=(200.80760756868844, 51.055274753758425)), Blob(location=(65.00956738768718, 58.054856489184694)), Blob(location=(6.943717466743783, 125.88616975130132)), Blob(location=(20.162650966183573, 155.87777777777777)), Blob(location=(95.99000452625226, 233.1065178032589)), Blob(location=(139.15171258376768, 239.77087211466866)), Blob(location=(32.85897913561848, 275.91253725782417)), Blob(location=(138.2107745779543, 346.0189299900695)), Blob(location=(283.90282877169557, 394.1637600133511)), Blob(location=(365.89937621124034, 436.1137960271318)), Blob(location=(394.92693542934416, 499.1057302231237)), Blob(location=(471.7710789129011, 502.1268009168304))]
 [Blob(location=(200.19506517690874, 51.08976373370577)), Blob(location=(65.01978165064102, 58.025440705128204)), Blob(location=(6.931654676258993, 125.87174875484229)), Blob(location=(20.787916666666668, 155.95989583333332)), Blob(location=(95.89112119248217, 233.0899222294232)), Blob(location=(138.96522727272728, 239.1772159090909)), Blob(location=(32.932082043343655, 275.96047794117646)), Blob(location=(138.7595775462963, 345.85338541666664)), Blob(location=(283.9181427125506, 394.2024291497976)), Blob(location=(365.12209903492646, 436.16730813419116)), Blob(location=(393.81326559020044, 489.8491555308092)), Blob(location=(471.97356507059544, 502.16563075506446))]
 [Blob(location=(200.14015957446807, 51.045744680851065)), Blob(location=(65.02506510416667, 58.022243923611114)), Blob(location=(6.9343468468468465, 125.92105855855856)), Blob(location=(20.875526685393258, 155.8841877340824)), Blob(location=(95.22824117832388, 233.13090737240077)), Blob(location=(138.77283141517478, 239.08738277919863)), Blob(location=(32.987841639871384, 275.8184284565916)), Blob(location=(139.15357881433823, 345.85584214154414)), Blob(location=(283.92467510259917, 394.17907831737347)), Blob(location=(365.9851273148148, 436.2182002314815)), Blob(location=(393.1716946248196, 491.16585497835496)), Blob(location=(471.97635785824343, 502.1564907550077))]
 ⋮
 [Blob(location=(334.934481216458, 5.1735521019677995)), Blob(location=(65.03098081440876, 57.99148394675019)), Blob(location=(6.917090874811463, 125.8455411010558)), Blob(location=(11.042433647260275, 151.16323309075344)), Blob(location=(99.09790580182529, 234.90710560625814)), Blob(location=(139.87814854048963, 238.01000470809794)), Blob(location=(30.800045454545455, 274.0962727272727)), Blob(location=(145.02299222797927, 347.05168393782384)), Blob(location=(286.0179410701374, 409.01825741142443)), Blob(location=(403.7755548302872, 412.8786227154047)), Blob(location=(371.12911419576415, 452.16535489410415)), Blob(location=(371.99444235116806, 501.7769875659382))]
 [Blob(location=(65.03917438921651, 57.98983782645325)), Blob(location=(6.9319893460690665, 125.89529757531227)), Blob(location=(10.879835996635828, 151.0341148023549)), Blob(location=(99.16483807506053, 235.12969128329297)), Blob(location=(139.7819182790224, 237.9042769857434)), Blob(location=(31.051108374384235, 274.01282840722496)), Blob(location=(145.15011400214593, 346.94742489270385)), Blob(location=(285.9293354016982, 409.0204114957544)), Blob(location=(403.193660774983, 409.1972085316111)), Blob(location=(370.92103819139595, 452.08379060579455)), Blob(location=(346.16031449893393, 486.0889303482587))]
 [Blob(location=(65.05435788304959, 58.004441154700224)), Blob(location=(6.882364649681529, 125.89327229299363)), Blob(location=(10.088765520534862, 150.93857449856733)), Blob(location=(99.1483949945593, 235.08691512513602)), Blob(location=(139.82529222328245, 237.99505009541986)), Blob(location=(31.202367950754567, 273.9771644162033)), Blob(location=(145.14731447846393, 346.9976647638817)), Blob(location=(285.847576079264, 409.0447186836518)), Blob(location=(403.80591530849824, 408.7763023864959)), Blob(location=(371.01418779481133, 452.80498231132077)), Blob(location=(363.92133763227514, 481.95626653439155))]
 [Blob(location=(64.97551229508197, 57.986168032786885)), Blob(location=(6.92067468269873, 125.97064963259854)), Blob(location=(10.15625, 150.92557458803122)), Blob(location=(99.04844628357277, 235.03634447220486)), Blob(location=(139.15341302841304, 237.9350311850312)), Blob(location=(30.985938641344045, 274.00903944485026)), Blob(location=(145.8075594083414, 346.9615361299709)), Blob(location=(285.8013977002379, 409.09635210150674)), Blob(location=(407.2303630212143, 416.88295537673736)), Blob(location=(370.9419164882227, 453.15551391862954)), Blob(location=(385.8530839073262, 480.13020507201))]
 [Blob(location=(65.03441629955947, 57.98557268722467)), Blob(location=(6.898495199409158, 125.89032496307237)), Blob(location=(10.162935166498487, 151.00791498486376)), Blob(location=(99.05446105072464, 235.0534797705314)), Blob(location=(139.01870559502663, 238.04573712255774)), Blob(location=(30.96206743566992, 274.194737133984)), Blob(location=(146.0618932038835, 346.9470064724919)), Blob(location=(285.8186046511628, 409.0641472868217)), Blob(location=(407.14200530035333, 421.1410777385159)), Blob(location=(371.076951647758, 453.81516747703944)), Blob(location=(354.9513140161725, 483.2014824797844))]
 [Blob(location=(64.98919172932331, 57.999436090225565)), Blob(location=(6.932689249363868, 125.9011211832061)), Blob(location=(10.065239294710327, 151.01656171284634)), Blob(location=(99.03746841440304, 235.08642608970308)), Blob(location=(139.18630898366607, 237.96795598911072)), Blob(location=(31.057125796178344, 274.86176353503186)), Blob(location=(146.18247873345936, 346.8342095935728)), Blob(location=(285.87763109305763, 409.1898079763663)), Blob(location=(400.0669420753376, 419.22776741293535)), Blob(location=(349.95906593406596, 441.8051282051282)), Blob(location=(371.2371198217095, 454.0636143156791))]
 [Blob(location=(65.00957401032703, 57.97224612736661)), Blob(location=(6.919293091168091, 125.95499465811966)), Blob(location=(10.081292388847023, 151.2273926149209)), Blob(location=(99.15754437869822, 234.89460059171597)), Blob(location=(139.20848171889838, 238.08360042735043)), Blob(location=(30.983882978723404, 274.8036170212766)), Blob(location=(146.0442620650954, 346.17080527497194)), Blob(location=(286.01755930318757, 409.81717939214235)), Blob(location=(392.02613473909935, 422.14394210150107)), Blob(location=(371.21529588112617, 454.05331074035456)), Blob(location=(359.011837808418, 464.8710087082729))]
 [Blob(location=(346.85339701417, 5.8958755060728745)), Blob(location=(65.03873239436619, 57.995598591549296)), Blob(location=(6.875691562932227, 125.86065006915629)), Blob(location=(10.08884431916739, 151.8376517779705)), Blob(location=(99.84335443037975, 234.98613424383745)), Blob(location=(139.015625, 238.13664874551972)), Blob(location=(30.96281061114842, 274.89678475486903)), Blob(location=(145.96347891566265, 347.02635542168673)), Blob(location=(286.1115861837693, 409.97950201207243)), Blob(location=(389.11840770791076, 432.8401369168357)), Blob(location=(370.0494140625, 454.79563802083334))]
 [Blob(location=(339.09098288075563, 4.282117030696576)), Blob(location=(65.00740262321145, 57.986933624801274)), Blob(location=(6.903142755681818, 125.81507457386364)), Blob(location=(9.993721315655279, 151.85954232534422)), Blob(location=(99.84081967213115, 234.2139344262295)), Blob(location=(139.0454322200393, 238.15418303863785)), Blob(location=(30.792694356748225, 274.7905485398579)), Blob(location=(145.79060532341157, 347.0629293073841)), Blob(location=(286.0447966919366, 410.08541523087524)), Blob(location=(383.9969439117929, 428.07873921380633)), Blob(location=(371.1846745027125, 454.0914613471971))]</code></pre><p><code>blobs</code> is a vector where each element corresponds to a single frame of <code>video</code>. Each element is itself a vector of <code>Blob</code>s, an object which contains all the information about the blob; its position in the image, its size and other properties. The <code>Blob</code> API is described <a href="XXX">here</a>.</p><p>A typical step after the initial detection is to look at the zeroth and second intensity moments of the blobs, which can provide information about differences between the detected objects.</p><pre><code class="language-julia hljs">m0 = map.(zeroth_moment, blobs)
m2 = map.(second_moment, blobs)
scatter(vcat(m0...), vcat(m2...); alpha=0.5, axis=(xlabel=&quot;m0&quot;, ylabel=&quot;m2&quot;))</code></pre><img src="c6e7416c.png" alt="Example block output"/><p>The zeroth moment (<code>m0</code>) is proportional to the total intensity of the blob; the tight cluster in the bottom left (<code>0.5&lt;m0&lt;0.7</code> and <code>1.6&lt;m2&lt;1.7</code>), which is well separated from the rest of the datapoints, is then likely to identify spurious detections resulting from pixel shot noise. If this is the case, it would be good to filter out these blobs before moving on to the tracking. A clean set of blobs without spurious detections can drastically improve the tracking quality, but excessive filtering can have the opposite effects.</p><p>To verify our hypothesis, i.e., low-<code>m0</code> low-<code>m2</code> blobs are spurious detections, we have to visually check what these blobs correspond to in the image. We can then separate the two populations and highlight them in the images with different colors.</p><pre><code class="language-julia hljs">maybe_spurious = [
    findall(@. (0.5 &lt; m0[i] &lt; 0.7) &amp;&amp; (1.6 &lt; m2[i] &lt; 1.7))
    for i in eachindex(blobs)
]
A = @. view(blobs, maybe_spurious)
B = @. view(blobs, setdiff(eachindex(blobs), maybe_spurious))

# visualize the two populations in frame t
let t = 1
    fig, ax, = heatmap(video[:,:,t], colormap=:bone)
    # blobs can be directly plotted in Makie with scatter
    scatter!(ax, A[t], color=:red, alpha=0.3, markersize=30)
    scatter!(ax, B[t], color=:green, alpha=0.3, markersize=30)
    fig
end</code></pre><img src="990e1e92.png" alt="Example block output"/><p>The red marker (as can be confirmed by trying different frames <code>t</code>), is always associated to a specific object in the image, but we clearly see it as quite bright! Why is it different from the others then? By zooming in, we can see that it is a <em>single</em> bright pixel, whereas the other blobs, while still extremely small, correspond to a larger bright area.</p><p>It turns out that the camera I used to collect this video has a dead pixel, which is always showing up as illuminated. That is what our moments-based filtering has allowed us to identify.</p><p>It is also possible to directly access the <code>intensity_map</code> of a blob, i.e. the set of pixels which have been identified as a unique blob. We can, for instance, plot the intensity_map of this spurious blob along side that of another blob (<code>j</code>) in the other population. We see that &quot;real&quot; blobs are generally brighter and/or more extended than the spurious one.</p><pre><code class="language-julia hljs">let t=1, I_A=intensity_map(A[t][1]), j=1, I_B=intensity_map(B[t][j])
    M = max(maximum(I_A), maximum(I_B))
    xA, yA = collect.(axes(I_A))
    zA = parent(I_A)
    fig, ax1 = heatmap(xA, yA, zA; colorrange=(0,M), axis=(title=&quot;Spurious&quot;,))
    ax2 = Axis(fig[1,2], title=&quot;Real&quot;)
    xB, yB = collect.(axes(I_B))
    zB = parent(I_B)
    heatmap!(ax2, xB, yB, zB; colorrange=(0,M))
    fig
end</code></pre><img src="1b4523fb.png" alt="Example block output"/><p>Now we can safely filter out the spurious detections and move on to the tracking using the <code>track_blobs</code> function.</p><p>In principle, we don&#39;t need to do anything special and we can just call <code>track_blobs(blobs)</code>, but we will see the results are much less than optimal.</p><pre><code class="language-julia hljs"># reassign blobs to the subpopulation without spurious detections
blobs = deepcopy(B)
# do the tracking
trajectories = track_blobs(blobs)
# visualize plotting trajectories one by one
let
    fig = Figure()
    ax = Axis(fig[1,1])
    for track in trajectories
        lines!(ax, track)
    end
    fig
end</code></pre><img src="d1c27e04.png" alt="Example block output"/><p>We see that the algorithm tends to connect points that are far away from each other. Indeed, since the tracking is based on finding the &quot;minimum cost flow&quot; between successive frames, it always tries to connect points in order to not interrupt any trajectory. This leads, however, to unreasonable connections. The first thing to do, therefore, is to define the maximum distance that an object can cover during a single frame: any connection between points at a distance larger than this threshold will be less favorable than to just interrupt the trajectory.</p><p>The maximum distance can be set through the <code>maxdist</code> keyword. In our case, after visual inspection it seems reasonable to set this limit to 60 pixels</p><pre><code class="language-julia hljs">maxdist = 60
trajectories = track_blobs(blobs; maxdist)
let
    fig = Figure()
    ax = Axis(fig[1,1])
    for track in trajectories
        lines!(ax, track)
    end
    fig
end</code></pre><img src="7152b5d6.png" alt="Example block output"/><p>This is already much better. But we can do more.</p><pre><code class="language-julia hljs">scatter(length.(trajectories))</code></pre><img src="f299cec8.png" alt="Example block output"/><p>A quick look at the length of the trajectories we obtained shows that we have a few very long trajectories (basically spanning the entire video) a few medium-length ones and then a bunch of trajectories only 1-frame long.</p><p>A 1-frame trajectory is basically a blob that has been detected but not connected to anything. This can happen for various reasons. If it&#39;s spurious detections that survived our filtering but didn&#39;t produce any connection, that&#39;s perfect, we will just filter these trajectories out. But they may also be real objects which, somehow, were not consistently detected across successive frames and hence did not produce a trajectory.</p><p>In fact, our algorithm has been only looking at immediately successive frames, but we can also account for the fact that an object might disappear from the field of view for a few frames, and that we may still be able to recognize it if it appears again.</p><p>Connections across frame gaps are controlled by the <code>memory</code> keyword. By default it is set to 1, meaning that only the immediate next frame is investigated for a connection. But increasing its value allows us to close gaps due to objects disappearing from the field of view. Allowing too much <code>memory</code> will, however, have detrimental effects: the objects are allowed to travel <code>maxdist</code> <em>every frame</em>, therefore large <code>memory</code> values will allow connections between objects far away in space and time.</p><pre><code class="language-julia hljs">maxdist = 60
memory = 5
trajectories = track_blobs(blobs; maxdist, memory)
let
    fig = Figure()
    ax = Axis(fig[1,1])
    for track in trajectories
        lines!(ax, track)
    end
    fig
end</code></pre><img src="32b2856c.png" alt="Example block output"/><p>The <code>track_blobs</code> function has various additional parameters that can be tuned to optimize the outcome.</p><p>All of them can be explored through an interactive GUI (available via GLMakie) called by <code>explore_tracking(video, blobs; kwargs...)</code>.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Monday 20 October 2025 13:14">Monday 20 October 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
